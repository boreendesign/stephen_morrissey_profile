<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Beautiful Soup | Stephen Morrissey</title>
    <link>https://stephenmorrissey.me/tags/beautiful-soup/</link>
      <atom:link href="https://stephenmorrissey.me/tags/beautiful-soup/index.xml" rel="self" type="application/rss+xml" />
    <description>Beautiful Soup</description>
    <generator>Source Themes Academic (https://sourcethemes.com/academic/)</generator><language>en-us</language><lastBuildDate>Thu, 31 Oct 2019 00:00:00 +0000</lastBuildDate>
    <image>
      <url>https://stephenmorrissey.me/img/icon-192.png</url>
      <title>Beautiful Soup</title>
      <link>https://stephenmorrissey.me/tags/beautiful-soup/</link>
    </image>
    
    <item>
      <title>Scrap Content to build a Hugo Site - Part 1</title>
      <link>https://stephenmorrissey.me/project/python-scraping/</link>
      <pubDate>Thu, 31 Oct 2019 00:00:00 +0000</pubDate>
      <guid>https://stephenmorrissey.me/project/python-scraping/</guid>
      <description>

&lt;h1 id=&#34;scrap-content-and-build-a-hugo-site&#34;&gt;Scrap Content and Build a Hugo Site&lt;/h1&gt;

&lt;p&gt;This is the first part of a project I worked on that using Python, Beautiful Soup, Hugo, Netlify, Zapier and Datatables to create a site that scraped pricing data every 24 hours and rendered it on a static site.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;PART 1 : Scrape the content to a JSON and CSV file (This Article)&lt;/li&gt;
&lt;li&gt;PART 2 : Build the Hugo site and pull in the JSON file for rendering (coming soon)&lt;/li&gt;
&lt;li&gt;PART 3 : Deploy to Netlify and Schedule to run every 24 hours (coming soon)&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;requirements&#34;&gt;Requirements&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;You need to have python 3 and pip installed&lt;/li&gt;
&lt;li&gt;You need to install all the imported modules below using &lt;code&gt;pip&lt;/code&gt; eg &lt;code&gt;pip install requests&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;I recommend installing Jupyter notebooks, its an easy way to test your code in python and seeing the results after each code block&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;steps&#34;&gt;Steps&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;Setup and Helper Functions&lt;/li&gt;
&lt;li&gt;Import the Site Data from a CSV&lt;/li&gt;
&lt;li&gt;For Each Site for teaser content, scrape the data (Title, Price and Url to the more information page)&lt;/li&gt;
&lt;li&gt;Combine all the site data into a data frame&lt;/li&gt;
&lt;li&gt;Export this data to a json and csv file for use on the hugo site and other projects (Drupal Import )&lt;/li&gt;
&lt;li&gt;Build the hugo site&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;setup-and-helper-functions&#34;&gt;Setup and Helper Functions&lt;/h2&gt;

&lt;h3 id=&#34;import-the-neccesary-python-modules&#34;&gt;Import the neccesary python modules&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;import requests
from bs4 import BeautifulSoup
import pandas as pd
from datetime import datetime
import re
import hashlib
import subprocess
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;variable-setup&#34;&gt;Variable Setup&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;timestamp_full = datetime.today().strftime(&#39;%Y-%m-%d-%H:%M:&#39;)
timestamp_day  = datetime.today().strftime(&#39;%Y-%m-%d&#39;)

# Site Import Data
site_data_file = &#39;importfiles/sitedata.csv&#39;
site_data_df = pd.DataFrame(columns=[&amp;quot;company&amp;quot;,&amp;quot;site&amp;quot;, &amp;quot;collection&amp;quot;])

# Site Export Data
scraped_data_file = &#39;exportfiles/scraped_sites&#39;

&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;standard-helper-functions&#34;&gt;Standard Helper Functions&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;# Log processing commands to see where a site may have failed
def log_processing(url):
    print(&#39;  ---&amp;gt; processing &#39; + url)

# Pull out everything but numbers and letters from the imported string
def returnNumbersAndLettersOnly(oldString):
    newString = &#39;&#39;.join(e for e in oldString if e.isalnum())
    return newString

# Pull out everything but numbers from the imported string
def returnNumbersOnly(oldString):
    newString = &#39;&#39;.join(e for e in oldString if e.isdigit())
    return newString

# Set default headers for call
# Testing out calls
def getHeadersObject(url):
    headers = {
        &#39;User-Agent&#39;: &amp;quot;PostmanRuntime/7.18.0&amp;quot;,
        &#39;Accept&#39;: &amp;quot;*/*&amp;quot;,
        &#39;Cache-Control&#39;: &amp;quot;no-cache&amp;quot;,
        &#39;Accept-Encoding&#39;: &amp;quot;gzip, deflate&amp;quot;,
        &#39;Referer&#39;: url,
        &#39;Connection&#39;: &amp;quot;keep-alive&amp;quot;,
        &#39;cache-control&#39;: &amp;quot;no-cache&amp;quot;
    }
    return headers

# Get the index of an item and handle the exception where the index does not exist and set to empty
def pop(item,index):

    try:
        return item[index]
    except IndexError:
        return &#39;null&#39;

    return breakout
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;custom-functions&#34;&gt;Custom Functions&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;# Sample Scraping Function
def scrapeTeaserDataFromCollection_type1(url,site):

    site_scraped_data_df_temp = pd.DataFrame(columns=[&amp;quot;site&amp;quot;,&amp;quot;title&amp;quot;, &amp;quot;url&amp;quot;,&amp;quot;price&amp;quot;])
    soup = BeautifulSoup(requests.get(url).text, &#39;html.parser&#39;)
    resultsRow = soup.find_all(&#39;article&#39;, {&#39;class&#39;: &#39;box-info&#39;})

    for resultRow in resultsRow:
        resultRowBreakdown = resultRow.find(&#39;p&#39;, {&#39;class&#39;: &#39;text-info&#39;}).text.split(&#39;from&#39;)
        try:
            site_scraped_data_df_temp = site_scraped_data_df_temp.append(
                {
                    &#39;site&#39;:site,
                    &#39;title&#39;:pop(resultRowBreakdown,0),
                    &#39;price&#39;:returnNumbersOnly(pop(resultRowBreakdown,1)),
                    &#39;url&#39;:resultRow.find(&#39;a&#39;).get(&#39;href&#39;)
                }
            , ignore_index=True)
        except IndexError as e:
            gotdata = &#39;&#39;

    return site_scraped_data_df_temp

# Sample Scraping Function
def scrapeTeaserDataFromCollection_type2(url,site):

    site_scraped_data_df_temp = pd.DataFrame(columns=[&amp;quot;site&amp;quot;,&amp;quot;title&amp;quot;, &amp;quot;url&amp;quot;,&amp;quot;price&amp;quot;])
    soup = BeautifulSoup(requests.get(url).text, &#39;html.parser&#39;)
    resultsRow = soup.find(&#39;div&#39;, {&#39;class&#39;: &#39;ppb_tour_classic&#39;}).find_all(&#39;div&#39;, {&#39;class&#39;: &#39;element&#39;})

    for resultRow in resultsRow:
        try:
            site_scraped_data_df_temp = site_scraped_data_df_temp.append(
                {
                    &#39;site&#39;:site,
                    &#39;title&#39;:resultRow.find(&#39;h4&#39;).text, #&amp;lt;h2&amp;gt;&amp;lt;a -.find(&#39;a&#39;),
                    &#39;price&#39;:returnNumbersOnly(resultRow.find(&#39;div&#39;, {&#39;class&#39;: &#39;tour_price&#39;}).text.strip(&#39;$&#39;)),
                    &#39;url&#39;:resultRow.find(&#39;a&#39;,{&#39;class&#39;: &#39;tour_link&#39;}).get(&#39;href&#39;)
                }
            , ignore_index=True)
        except IndexError as e:
            gotdata = &#39;&#39;

    return site_scraped_data_df_temp
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;import-the-site-data&#34;&gt;Import the site data&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;# Import and Print out the Sites you want to Scrape
site_data_df = pd.read_csv(site_data_file)
site_data_df
&lt;/code&gt;&lt;/pre&gt;

&lt;div&gt;
&lt;style scoped&gt;
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
&lt;/style&gt;
&lt;table border=&#34;1&#34; class=&#34;dataframe&#34;&gt;
  &lt;thead&gt;
    &lt;tr style=&#34;text-align: right;&#34;&gt;
      &lt;th&gt;&lt;/th&gt;
      &lt;th&gt;company&lt;/th&gt;
      &lt;th&gt;site&lt;/th&gt;
      &lt;th&gt;collection&lt;/th&gt;
      &lt;th&gt;scrape_type&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;th&gt;0&lt;/th&gt;
      &lt;td&gt;Stephen Morrissey 1&lt;/td&gt;
      &lt;td&gt;https://stephenmorrissey.me&lt;/td&gt;
      &lt;td&gt;https://stephenmorrissey.me/post/type1-content/&lt;/td&gt;
      &lt;td&gt;type1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;1&lt;/th&gt;
      &lt;td&gt;Stephen Morrissey 2&lt;/td&gt;
      &lt;td&gt;https://stephenmorrissey.me&lt;/td&gt;
      &lt;td&gt;https://stephenmorrissey.me/post/type1-content/&lt;/td&gt;
      &lt;td&gt;type1&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;

&lt;h2 id=&#34;scrape-pages&#34;&gt;Scrape Pages&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;site_scraped_data_df = pd.DataFrame(columns=[&amp;quot;site&amp;quot;,&amp;quot;title&amp;quot;, &amp;quot;url&amp;quot;,&amp;quot;price&amp;quot;])

#Go Through All Sites and Scrape the Appropriate Data

for index, row in site_data_df.iterrows():
    log_processing(row[&#39;company&#39;])
    if row[&#39;scrape_type&#39;] == &#39;type1&#39;:
        site_scraped_data_df = site_scraped_data_df.append(scrapeTeaserDataFromCollection_type1(row[&#39;collection&#39;],row[&#39;company&#39;]), ignore_index=True)
    elif row[&#39;scrape_type&#39;] == &#39;type2&#39;:
        site_scraped_data_df = site_scraped_data_df.append(scrapeTeaserDataFromCollection_type2(row[&#39;collection&#39;],row[&#39;company&#39;]), ignore_index=True)
    else:
        print(&amp;quot;NOT SCRAPE TYPE FOUND&amp;quot;)



&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;  ---&amp;gt; processing Stephen Morrissey 1
  ---&amp;gt; processing Stephen Morrissey 2
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;output-results-to-csv-json-files&#34;&gt;Output results to CSV &amp;amp; JSON files&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;#Output to CSV
site_scraped_data_df.to_csv(scraped_data_file+&#39;.csv&#39;)
#Output to JSON (Orient will allow you to input this into Datatables.net structure for display on a site)
site_scraped_data_df.to_json(scraped_data_file+&#39;.json&#39;,orient=&#39;records&#39;)
print(site_scraped_data_df)
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;                  site                  title       url price
0  Stephen Morrissey 1    Sample Page Content  /testurl  3200
1  Stephen Morrissey 1  Sample Page Content 2  /testurl   900
2  Stephen Morrissey 1  Sample Page Content 3  /testurl  1300
3  Stephen Morrissey 2    Sample Page Content  /testurl  3200
4  Stephen Morrissey 2  Sample Page Content 2  /testurl   900
5  Stephen Morrissey 2  Sample Page Content 3  /testurl  1300
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/boreendesign/public_projects/blob/master/Scrape%20Content%20and%20Build%20Hugo%20Site.ipynb&#34; target=&#34;_blank&#34;&gt;Get the code&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;PART 2 - Building the Hugo Site to display the information on Netlify (Coming Soon)&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
